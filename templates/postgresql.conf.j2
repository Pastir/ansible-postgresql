# {{ ansible_managed | comment }}

data_directory = '{{ postgresql_data_directory }}'      # use data in another directory
hba_file = '{{ postgresql_hba_file }}'                  # host-based authentication file
ident_file = '/etc/postgresql/11/main/pg_ident.conf'    # ident configuration file
external_pid_file = '/var/run/postgresql/11-main.pid'   # write an extra PID file


listen_addresses = '{{ postgresql_listen_addresses }}'               # what IP address(es) to listen on;
port =  {{ postgresql_port }}                                        # (change requires restart)
max_connections = {{ postgresql_max_connections }}                   # (change requires restart)
superuser_reserved_connections = 3                                   # (change requires restart)
unix_socket_directories = '{{ postgresql_unix_socket_directories }}' # comma-separated list of directories


shared_buffers = {{ (ansible_memtotal_mb * 0.25)|int }}MB # min 128kB
huge_pages = try

temp_buffers = 8MB                      # min 800kB
#max_prepared_transactions = 0          # zero disables the feature
work_mem = 16MB                         # min 64kB
maintenance_work_mem = 256MB            # min 1MB
dynamic_shared_memory_type = posix      # the default is the first option

# - Cost-Based Vacuum Delay -
vacuum_cost_delay = 0                   # 0-100 milliseconds
vacuum_cost_page_hit = 0                # 0-10000 credits
vacuum_cost_page_miss = 1               # 0-10000 credits
vacuum_cost_page_dirty = 10             # 0-10000 credits
vacuum_cost_limit = 200                 # 1-10000 credits

# - Background Writer -

#bgwriter_delay = 200ms                 # 10-10000ms between rounds
#bgwriter_lru_maxpages = 100            # max buffers written/round, 0 disables
#bgwriter_lru_multiplier = 2.0          # 0-10.0 multiplier on buffers scanned/round
#bgwriter_flush_after = 512kB           # measured in pages, 0 disables

# - Asynchronous Behavior -

effective_io_concurrency = 24           # 1-1000; 0 disables prefetching

#wal_level = logical                    # minimal, replica, or logical

checkpoint_timeout = 30min              # range 30s-1d
max_wal_size = 2GB
min_wal_size = 1GB
checkpoint_completion_target = 0.9      # checkpoint target duration, 0.0 - 1.0
checkpoint_warning = 30s                # 0 disables

max_wal_senders = 10                    # max number of walsender processes
wal_sender_timeout = 60s                # in milliseconds; 0 disables
max_replication_slots = 10              # max number of replication slots

#seq_page_cost = 1.0                    # measured on an arbitrary scale
random_page_cost = 1.3                  # same scale as above
#cpu_tuple_cost = 0.01                  # same scale as above
#cpu_index_tuple_cost = 0.005           # same scale as above
#cpu_operator_cost = 0.0025             # same scale as above
#parallel_tuple_cost = 0.1              # same scale as above
#parallel_setup_cost = 1000.0           # same scale as above

effective_cache_size = {{ (ansible_memtotal_mb * 0.75)|int }}MB

log_line_prefix = '%m %e %i [%c %x %v] [%p] %q%u@%d '

log_timezone = 'UTC'
log_checkpoints = on

cluster_name = '11/main'                                            # added to process titles if nonempty

stats_temp_directory = '/var/run/postgresql/11-main.pg_stat_tmp'

autovacuum = on
autovacuum_max_workers = 10             # max number of autovacuum subprocesses
log_autovacuum_min_duration = 1000      # -1 disables, 0 logs all actions and
autovacuum_naptime = 1000ms             # time between autovacuum runs
autovacuum_vacuum_threshold = 50        # min number of row updates before
autovacuum_analyze_threshold = 5        # min number of row updates before
autovacuum_vacuum_scale_factor = 0.05   # fraction of table size before vacuum
autovacuum_analyze_scale_factor = 0.01  # fraction of table size before analyze
autovacuum_vacuum_cost_delay = 1ms      # default vacuum cost delay for

datestyle = 'iso, mdy'
timezone = 'UTC'

lc_messages = 'en_US.UTF-8'                     # locale for system error message
lc_monetary = 'en_US.UTF-8'                     # locale for monetary formatting
lc_numeric = 'en_US.UTF-8'                      # locale for number formatting
lc_time = 'en_US.UTF-8'                         # locale for time formatting

default_text_search_config = 'pg_catalog.english'
include_dir = 'conf.d'

shared_preload_libraries = 'pg_stat_statements'

archive_mode = off
archive_command = 'cp %p /var/lib/postgresql/11/main/archive/%f'

log_lock_waits = on
log_min_messages = WARNING
hot_standby = on
wal_keep_segments = 64
log_statement = 'none'
